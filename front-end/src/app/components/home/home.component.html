<div class="wrapper">
  <div class="sidebar" [class.collapsed]="!showUserList">
    <button (click)="toggleUserList()" class="toggle-btn">
      <img *ngIf="showUserList" src="arrow_back.png" alt="Open icon" class="icon-photo" />
      <img *ngIf="!showUserList" src="arrow.png" alt="Closed icon" class="icon-photo" />
    </button>

    <div class="user-list" *ngIf="showUserList">
      <app-users></app-users>
    </div>
  </div>

  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">
        L’empire des plumes et des songes.
      </h1>
      <p class="hero-description">
        Sous la voûte étoilée s’écrivent les songes,
        et la plume éclaire plus que mille flambeaux.
        Celui qui conte partage son âme,
        et fait naître au lecteur un monde nouveau.
      </p>
     
      <div class="scroll-indicator">
        <span>Scroll down</span>
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8 2V14M2 8L8 14L14 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- SECTION 1: Featured Articles (Top 4) -->
    <div class="featured-section" *ngIf="AllPosts.length > 0">
      <div class="featured-grid">
        <!-- Main Featured Post (Left Side) -->
        <div class="main-featured-post" *ngIf="AllPosts[0]" (click)="onCardClick(AllPosts[0].id)">
          <div class="featured-image-container">
            <div class="post-media">

              <ng-container *ngIf="AllPosts[0].medias && AllPosts[0].medias.length > 0; else noMedia">

                <img *ngIf="AllPosts[0].medias[AllPosts[0].selectedMediaIndex].type === 'IMAGE'"
                  [src]="AllPosts[0].medias[AllPosts[0].selectedMediaIndex].url" [alt]="AllPosts[0].title"
                  class="featured-image" onerror="this.src='profil.jpg'" />

                <video *ngIf="AllPosts[0].medias[AllPosts[0].selectedMediaIndex].type === 'VIDEO'"
                  [src]="AllPosts[0].medias[AllPosts[0].selectedMediaIndex].url" class="featured-image"
                  controls></video>


                <button *ngIf="AllPosts[0].medias.length > 1" class="media-btn prev"
                  (click)="prevMedia(AllPosts[0], $event)">&#10094;</button>
                <button *ngIf="AllPosts[0].medias.length > 1" class="media-btn next"
                  (click)="nextMedia(AllPosts[0], $event)">&#10095;</button>
              </ng-container>

              <ng-template #noMedia>
                <img src="plume.png" alt="Image par défaut" class="featured-image" />
              </ng-template>
            </div>

            <div class="featured-overlay"></div>
            <div class="featured-content">
              <div class="featured-meta">
                <span class="featured-author" (click)="onUserClick(AllPosts[0].author.id, $event)">{{
                  AllPosts[0].author.name }}</span>
                <span class="featured-date">{{ AllPosts[0].publishDate | date:'d MMM, yyyy' }}</span>
              </div>
              <h2 class="featured-title">{{ AllPosts[0].title }}</h2>
              <p class="featured-description">{{ AllPosts[0].description }}</p>
              <div class="featured-tags">
                <span class="featured-tag">Featured</span>
                <span class="featured-tag">Latest</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Side Articles (Right Side) -->
        <div class="side-articles">
          <div class="side-article" *ngFor="let post of AllPosts.slice(1, 4)" (click)="onCardClick(post.id)">
            <div class="side-article-image">
              <div class="post-media">
                <ng-container *ngIf="post.medias && post.medias.length > 0; else noMedia">
                  <img *ngIf="post.medias[post.selectedMediaIndex].type === 'IMAGE'"
                    [src]="post.medias[post.selectedMediaIndex].url" [alt]="post.title"
                    onerror="this.src='plume.png'" />

                  <video *ngIf="post.medias[post.selectedMediaIndex].type === 'VIDEO'"
                    [src]="post.medias[post.selectedMediaIndex].url" controls></video>

                  <button *ngIf="post.medias.length > 1" class="media-btn prev"
                    (click)="prevMedia(post, $event)">&#10094;</button>
                  <button *ngIf="post.medias.length > 1" class="media-btn next"
                    (click)="nextMedia(post, $event)">&#10095;</button>
                </ng-container>

                <ng-template #noMedia>
                  <img src="plume.png" alt="Image par défaut" />
                </ng-template>
              </div>
            </div>

            <div class="side-article-content">
              <div class="side-article-meta">
                <span class="side-author" (click)="onUserClick(post.author.id, $event)">{{ post.author.name }} </span>
                <span class="side-date">{{ post.publishDate | date:'d MMM, yyyy' }}</span>
              </div>
              <h3 class="side-article-title">{{ post.title }}</h3>
              <div class="side-article-tags">
                <span class="side-tag">News</span>
                <span class="side-tag">Popular</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <div class="all-articles-section">
      <div class="blog-grid">
        <div class="blog-card" *ngFor="let post of AllPosts.slice(4)" (click)="onCardClick(post.id)">

          <div class="card-image">
            <div class="post-media">
              <ng-container *ngIf="post.medias && post.medias.length > 0; else noMedia">
                <img *ngIf="post.medias[post.selectedMediaIndex].type === 'IMAGE'"
                  [src]="post.medias[post.selectedMediaIndex].url" [alt]="post.title" loading="lazy"
                  onerror="this.src='plume.png'" />


                <video *ngIf="post.medias[post.selectedMediaIndex].type === 'VIDEO'"
                  [src]="post.medias[post.selectedMediaIndex].url" controls></video>


                <button *ngIf="post.medias.length > 1" class="media-btn prev"
                  (click)="prevMedia(post, $event)">&#10094;</button>
                <button *ngIf="post.medias.length > 1" class="media-btn next"
                  (click)="nextMedia(post, $event)">&#10095;</button>
              </ng-container>

              <ng-template #noMedia>
                <img src="plume.png" alt="Image par défaut" />
              </ng-template>
            </div>
          </div>

          <div class="card-content">
            <h3 class="card-title">{{ post.title }}</h3>
            <p class="card-description">{{ post.description }}</p>

            <div class="card-meta">
              <div class="author-info" (click)="onUserClick(post.author.id, $event)">
                <div class="author-avatar">
                  <img [src]="post.author.avatar" [alt]="post.author.name" onerror="this.src='profil.jpg'">
                </div>
                <span class="author-name">{{ post.author.name }}</span>
              </div>
              <span class="publish-date">{{ post.publishDate | date:'d MMM, yyyy' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>


    <div class="loading-state" *ngIf="loading">
      <div class="loading-spinner"></div>
      <p>Loading articles...</p>
    </div>
  </div>
</div>