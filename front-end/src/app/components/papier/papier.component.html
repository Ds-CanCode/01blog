<div class="papier-container" (keydown)="onKeyDown($event)">
  <!-- Header avec titre et bouton fermer -->
  <mat-toolbar class="papier-header" color="primary">
    <span class="header-title">✍️ Créer un post</span>
    <span class="spacer"></span>
    <button mat-icon-button (click)="closePopup()" class="close-btn">
      <mat-icon>close</mat-icon>
    </button>
  </mat-toolbar>

  <!-- Contenu principal -->
  <div class="papier-content">
    
    <!-- Zone d'écriture avec Quill Editor -->
    <div class="editor-container">
      <quill-editor
        (onContentChanged)="onContentChanged($event)"
    
        class="content-editor">
      </quill-editor>
    </div>

    <!-- Input file caché -->
    <input 
      #fileInput 
      type="file" 
      (change)="onFileSelected($event)" 
      multiple 
      accept="image/*,video/*" 
      style="display: none;">

    <!-- Bouton pour ajouter des fichiers -->
    <div class="file-actions">
      <button 
        mat-raised-button 
        color="accent" 
        (click)="openFileDialog()"
        class="add-media-btn"
        [disabled]="selectedFiles.length >= maxFiles">
        <mat-icon>add_photo_alternate</mat-icon>
        Ajouter Images/Vidéos
        <span *ngIf="selectedFiles.length > 0">({{selectedFiles.length}}/{{maxFiles}})</span>
      </button>
    </div>

    <!-- Prévisualisation des fichiers sélectionnés -->
    <div class="media-preview-section" *ngIf="selectedFiles.length > 0">
      <h3 class="preview-title">
        <mat-icon>perm_media</mat-icon>
        Médias sélectionnés ({{selectedFiles.length}})
      </h3>
      
      <div class="media-grid">
        <div 
          *ngFor="let file of selectedFiles; let i = index" 
          class="media-item"
          [attr.data-index]="i">
          
          <!-- Prévisualisation image -->
          <div class="media-wrapper" *ngIf="file.type.startsWith('image/')">
            <img [src]="file.url" [alt]="file.name" class="preview-image">
            <div class="media-overlay">
              <div class="file-info">
                <span class="file-name" [title]="file.name">{{file.name}}</span>
                <span class="file-size">{{file.size}}</span>
              </div>
              <button 
                mat-mini-fab 
                color="warn" 
                (click)="removeFile(i)"
                class="remove-btn"
                [attr.aria-label]="'Supprimer ' + file.name">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>

          <!-- Prévisualisation vidéo -->
          <div class="media-wrapper" *ngIf="file.type.startsWith('video/')">
            <video [src]="file.url" class="preview-video" controls preload="metadata"></video>
            <div class="media-overlay">
              <div class="file-info">
                <span class="file-name" [title]="file.name">{{file.name}}</span>
                <span class="file-size">{{file.size}}</span>
              </div>
              <button 
                mat-mini-fab 
                color="warn" 
                (click)="removeFile(i)"
                class="remove-btn"
                [attr.aria-label]="'Supprimer ' + file.name">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions en bas -->
    <div class="papier-actions">
      <div class="action-buttons">
        <button 
          mat-raised-button 
          color="primary" 
          (click)="submitPost()"
          [disabled]="!canSubmit()"
          class="submit-btn">
          <mat-icon *ngIf="!isSubmitting">send</mat-icon>
          <mat-icon *ngIf="isSubmitting" class="spinning">refresh</mat-icon>
          {{isSubmitting ? 'Publication...' : 'Publier'}}
        </button>
        
        <button 
          mat-stroked-button 
          (click)="closePopup()"
          class="cancel-btn"
          [disabled]="isSubmitting">
          <mat-icon>cancel</mat-icon>
          Annuler
        </button>
      </div>
      
      <!-- Informations supplémentaires -->
      <div class="post-info">
        <div class="char-counter" *ngIf="postContent">
          <mat-icon>text_fields</mat-icon>
          {{postContent.length}} caractères
        </div>
        <div class="shortcuts-hint">
          <small>Ctrl+Entrée pour publier • Échap pour fermer</small>
        </div>
      </div>
    </div>
  </div>
</div>